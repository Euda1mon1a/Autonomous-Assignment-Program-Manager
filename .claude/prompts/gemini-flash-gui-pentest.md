# Gemini Flash GUI Pentest Prompt: Admin Bulk Panels

## Context

You are testing a **Medical Residency Scheduling Application** built with:
- **Frontend:** Next.js 14, React 18, TailwindCSS
- **Backend:** FastAPI, PostgreSQL, Redis
- **URL:** `http://localhost:3000`

The application manages ACGME-compliant schedules for medical residents. It contains **sensitive PII** (names, schedules, work hours) and requires robust security.

**Test Data Available:**
- 45 people (30 residents, 15 faculty)
- 14 blocks (0-13, ~28 days each)
- 730 half-day activities (365 days Ã— AM/PM sessions)
- 9 rotation templates
- Academic year: 2025-07-01 to 2026-06-30

**Terminology:**
- **Block:** ~4-week scheduling period (14 per year, numbered 0-13)
- **Half-day activity:** Individual AM or PM slot (730 per year)

---

## Target Admin Panels

### 1. User Management (`/admin/users`)

**Features:**
- User list with search, role filter, status filter
- Bulk selection (checkbox per row, select all)
- Bulk actions: Activate, Deactivate, Delete
- Individual actions: Edit, Lock/Unlock, Resend Invite, Delete
- "View As" impersonation for non-admin users
- Activity log tab
- Roles & permissions tab

**Bulk Operations to Test:**
```
- Select multiple users â†’ Bulk Activate
- Select multiple users â†’ Bulk Deactivate
- Select multiple users â†’ Bulk Delete
- Select All â†’ any bulk action
- Mixed selection (active + inactive) â†’ bulk action
```

### 2. Data Import (`/admin/import`)

**Features:**
- File upload modal (CSV/XLSX)
- Import history table with pagination
- Rollback capability per import batch
- Staged changes review before apply

**Bulk Operations to Test:**
```
- Upload large file (100+ records)
- Upload malformed CSV
- Upload with duplicate records
- Rollback completed import
- Rollback already-rolled-back import
```

### 3. Scheduling Laboratory (`/admin/scheduling`)

**Features:**
- Algorithm selection (Greedy, CP-SAT, PuLP, Hybrid)
- Constraint toggles (ACGME compliance rules)
- Block range selection (0-13)
- Dry run mode toggle
- Experiment queue with cancel
- Rollback points (create, revert)
- Locked assignments management
- Data sync trigger

**Bulk Operations to Test:**
```
- Queue multiple experiments simultaneously
- Cancel running experiment
- Create rollback â†’ immediate revert
- Unlock multiple locked assignments
- Generate schedule for all 14 blocks (730 activities)
- Generate with all constraints disabled
```

---

## Test Scenarios

### A. Input Validation Testing

| Test | Input | Expected |
|------|-------|----------|
| SQL Injection in search | `'; DROP TABLE users; --` | Escaped, no DB error |
| XSS in user name field | `<script>alert(1)</script>` | Sanitized output |
| Path traversal in file upload | `../../../etc/passwd` | Rejected |
| Oversized file upload | 50MB CSV | Size limit error |
| Invalid file type | `.exe` renamed to `.csv` | MIME check rejection |
| Unicode edge cases | `ð“—ð“®ð“µð“µð“¸` in names | Proper handling |
| Empty bulk selection | Click bulk action with 0 selected | Disabled or error |
| Negative block range | Start: 10, End: 5 | Validation error |
| Block range overflow | Start: 0, End: 99 | Clamped to 13 |

### B. Authorization Testing

| Test | Action | Expected |
|------|--------|----------|
| Access admin panel as resident | Direct URL `/admin/users` | 403 or redirect |
| Impersonate admin user | "View As" on admin | Should be blocked |
| Bulk delete self | Include own user in selection | Warning or block |
| Modify locked assignment | Edit locked block | Prevented |
| Cancel another user's experiment | API manipulation | 403 |

### C. State Manipulation

| Test | Action | Expected |
|------|--------|----------|
| Double-click bulk delete | Rapid clicks | Single execution |
| Submit during loading | Click while spinner shows | Blocked |
| Stale CSRF token | Replay old form | Token validation fail |
| Race condition in rollback | Two rollbacks simultaneously | One succeeds, one fails |
| Edit user while another edits | Concurrent updates | Conflict handling |

### D. Error Handling

| Test | Action | Expected |
|------|--------|----------|
| Network disconnect during import | Kill connection mid-upload | Graceful retry/error |
| Database timeout | Slow query | Timeout message |
| Invalid session | Expired JWT | Redirect to login |
| API returns 500 | Backend crash | User-friendly error |
| Partial bulk operation failure | 3/5 users fail | Clear status per item |

---

## Test Execution Checklist

### Pre-Test Setup
- [ ] Verify containers running: `docker ps`
- [ ] Confirm test data seeded: 45 people, 14 blocks, 730 activities
- [ ] Login as admin user
- [ ] Open browser DevTools (Network, Console tabs)

### User Management Panel
- [ ] Navigate to `/admin/users`
- [ ] Test search with special characters
- [ ] Test filter combinations (role + status)
- [ ] Select 5 users, click Bulk Activate
- [ ] Select 5 users, click Bulk Delete (confirm dialog appears)
- [ ] Click "View As" on a resident user
- [ ] Verify impersonation banner appears
- [ ] End impersonation
- [ ] Check Activity Log tab for audit trail
- [ ] Try to create user with duplicate email

### Import Panel
- [ ] Navigate to `/admin/import`
- [ ] Click "New Import"
- [ ] Upload valid CSV with 10 records
- [ ] Review staged changes
- [ ] Apply import
- [ ] Check import appears in history
- [ ] Click Rollback on the import
- [ ] Confirm rollback dialog
- [ ] Try to rollback again (should fail)

### Scheduling Laboratory
- [ ] Navigate to `/admin/scheduling`
- [ ] Configuration Tab:
  - [ ] Toggle each algorithm
  - [ ] Toggle constraints on/off
  - [ ] Set block range 0-13 (full year)
  - [ ] Enable Dry Run
  - [ ] Click Validate Configuration
  - [ ] Click Run (observe dry run behavior)
- [ ] Experimentation Tab:
  - [ ] Select multiple algorithms
  - [ ] Click "Queue Experiments"
  - [ ] Observe queue status
  - [ ] Cancel a queued experiment
- [ ] Metrics Tab:
  - [ ] Verify metrics display
  - [ ] Check recent runs table
- [ ] History Tab:
  - [ ] Enable comparison mode
  - [ ] Select two runs
  - [ ] Verify comparison view
- [ ] Overrides Tab:
  - [ ] Create rollback point
  - [ ] View locked assignments
  - [ ] Attempt to unlock one
  - [ ] Click Trigger Sync

---

## Security-Specific Tests

### OWASP Top 10 Coverage

| # | Vulnerability | Test Location |
|---|--------------|---------------|
| A01 | Broken Access Control | Admin panel access, View As, API endpoints |
| A02 | Cryptographic Failures | JWT tokens, session cookies |
| A03 | Injection | Search fields, file upload names |
| A04 | Insecure Design | Bulk delete without confirmation |
| A05 | Security Misconfiguration | Error messages, stack traces |
| A06 | Vulnerable Components | Check for outdated packages |
| A07 | Auth Failures | Session timeout, password reset |
| A08 | Integrity Failures | CSRF tokens, signed requests |
| A09 | Logging Failures | Audit log completeness |
| A10 | SSRF | File upload URL handling |

### Browser Console Checks
```javascript
// Check for sensitive data exposure
console.log(localStorage);
console.log(sessionStorage);
document.cookie;

// Check for inline scripts (CSP violation risk)
document.querySelectorAll('script:not([src])');

// Check for exposed API tokens
Object.keys(window).filter(k => k.includes('token') || k.includes('api'));
```

### Network Tab Checks
- JWT token in Authorization header (not URL)
- HTTPS in production (HTTP ok for localhost)
- No PII in GET request URLs
- Proper CORS headers
- Rate limiting headers present

---

## Reporting Template

For each issue found:

```markdown
### [SEVERITY] Issue Title

**Location:** /admin/users â†’ Bulk Delete
**Steps to Reproduce:**
1. Select 10 users
2. Click Bulk Delete
3. Rapidly click confirm twice

**Expected:** Single deletion request
**Actual:** Two DELETE requests sent

**Impact:** Potential data corruption, race condition
**Evidence:** [Screenshot/Network log]
**Recommendation:** Disable button after first click, debounce
```

Severity Levels:
- **CRITICAL:** Auth bypass, data exposure, injection
- **HIGH:** Privilege escalation, bulk data modification
- **MEDIUM:** CSRF, information disclosure
- **LOW:** UI bugs, missing validation
- **INFO:** Best practice recommendations

---

## API Endpoints to Monitor

```
POST /api/admin/users/bulk-action
POST /api/import/upload
POST /api/import/{id}/rollback
POST /api/admin/scheduling/run
POST /api/admin/scheduling/experiments
DELETE /api/admin/scheduling/experiments/{id}
POST /api/admin/scheduling/rollback-points
POST /api/admin/scheduling/rollback-points/{id}/revert
POST /api/admin/scheduling/sync
```

---

## Notes

- This is an **authorized security test** on a local development environment
- Test data is synthetic (no real PII)
- Document all findings with screenshots
- Do not modify production databases
- Focus on bulk operations as they have highest impact potential
