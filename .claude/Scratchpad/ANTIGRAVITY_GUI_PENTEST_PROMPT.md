# Antigravity GUI Pentest: Admin Templates Panel

## Mission

Execute comprehensive GUI security and functionality testing of the Admin Templates management panel. Your objectives are to:

1. **Verify all features work correctly** under normal usage
2. **Identify edge cases and error handling gaps**
3. **Test accessibility and keyboard navigation**
4. **Validate data persistence** (changes actually saved)
5. **Stress test bulk operations** with various payloads
6. **Document any UX issues, bugs, or security concerns**

Report findings with severity levels: CRITICAL / HIGH / MEDIUM / LOW / COSMETIC

---

## Setup

### Prerequisites
1. **Frontend running**: `http://localhost:3000`
2. **Backend running**: `http://localhost:8000`
3. **Authenticated session**: Log in as admin user before testing

### Target URL
```
http://localhost:3000/admin/templates
```

### Authentication
- Navigate to `http://localhost:3000/login`
- Use admin credentials (username: `admin`, check with user for password)
- Verify you see the dashboard before proceeding

---

## Test Scenarios

### 1. Navigation and Discovery

**Objective**: Locate and access all admin templates features

**Steps**:
1. Navigate to `http://localhost:3000/admin/templates`
2. Verify page loads without errors (no console errors, no blank screens)
3. Identify and document all visible UI elements:
   - Header with "Rotation Templates" title
   - "New Template" button (purple gradient)
   - "View Archived" button
   - Keyboard shortcuts button (keyboard icon)
   - Refresh button
   - Search input field with placeholder "Search templates..."
   - Activity Type filter dropdown
   - Template count display
   - Template table with columns: checkbox, Name, Activity Type, Abbreviation, Max Residents, Supervision, Created, Actions

4. Verify keyboard shortcuts panel opens with Shift+? key
5. Verify Cmd+K focuses search input
6. Verify R key refreshes the template list
7. Verify Escape key clears search or closes modals

**Expected Results**:
- Page loads in under 3 seconds
- All UI elements visible and properly styled
- Dark theme consistent throughout
- No layout shifts or flickering

**Report Issues**:
- Missing elements
- Broken styling
- Non-responsive buttons
- Console errors

---

### 2. Template Table Functionality

**Objective**: Test table sorting, filtering, and selection

**Steps**:

#### 2.1 Sorting
1. Click "Name" column header - verify ascending sort
2. Click again - verify descending sort (arrow indicator changes)
3. Click "Activity Type" header - verify sort works
4. Click "Created" header - verify sort by date works

#### 2.2 Filtering
1. Type "clinic" in search box - verify list filters in real-time
2. Clear search - verify all templates return
3. Select "Clinic" from Activity Type dropdown - verify filter works
4. Combine search + activity type filter - verify both work together
5. Click X button in search field - verify clears search

#### 2.3 Selection
1. Click checkbox on first template - verify row highlights purple
2. Click "select all" checkbox in header - verify all rows selected
3. Verify selection count appears at bottom ("X templates selected")
4. Click select all again - verify all deselected
5. Select multiple rows individually - verify count updates correctly

**Edge Cases to Test**:
- Search for non-existent template - verify "No templates found" message
- Search with special characters: `<script>`, `'; DROP TABLE`, `../../../`
- Search with very long string (500+ characters)
- Rapid clicking of sort headers (race condition)
- Filter + search + sort combination

---

### 3. Bulk Actions Toolbar

**Objective**: Test the floating bulk actions toolbar

**Steps**:

#### 3.1 Toolbar Appearance
1. Select 1+ templates - verify toolbar appears at bottom center
2. Verify toolbar shows: selection count, Activity Type dropdown, Supervision dropdown, Max Residents button, Delete button, Clear (X) button

#### 3.2 Bulk Activity Type Update
1. Select 3 templates
2. Click "Activity Type" dropdown in toolbar
3. Select "Inpatient" from options
4. Verify confirmation or immediate update
5. Verify selected templates now show "Inpatient" badge
6. Refresh page - verify changes persisted

#### 3.3 Bulk Supervision Update
1. Select 2 templates
2. Click "Supervision" dropdown
3. Select "Required"
4. Verify all selected templates now show "Required" in green

#### 3.4 Bulk Max Residents Update
1. Select 4 templates
2. Click "Max Residents" button
3. Verify modal appears with number input
4. Enter "5" and click Apply
5. Verify templates updated

**Edge Cases**:
- Set max_residents to 0 (invalid)
- Set max_residents to negative number
- Set max_residents to very large number (999999)
- Update 50+ templates at once
- Double-click Apply button rapidly

#### 3.5 Bulk Delete
1. Select 2 templates (note their names)
2. Click red "Delete" button
3. Verify confirmation modal appears with warning
4. Click Cancel - verify nothing deleted
5. Click Delete again, confirm - verify templates removed
6. Refresh page - verify they're gone from main list

**CRITICAL Edge Cases**:
- Delete all templates at once
- Delete while network disconnected (simulate network failure)
- Click Delete, then navigate away before confirmation

---

### 4. Archive/Restore Workflow

**Objective**: Test soft-delete archive functionality

**Steps**:

#### 4.1 View Archived Templates
1. Click "View Archived" button in header
2. Verify drawer slides in from right side
3. Verify drawer shows count of archived templates
4. Verify search field in drawer works
5. Click backdrop (dark area) - verify drawer closes
6. Click X button - verify drawer closes

#### 4.2 Restore Single Template
1. Open archived drawer
2. Find an archived template
3. Click the green rotate arrow (restore) button on that row
4. Verify template disappears from archived list
5. Close drawer - verify template appears in main list

#### 4.3 Bulk Restore
1. Open archived drawer
2. Select multiple archived templates via checkboxes
3. Click "Restore" button in selection bar
4. Verify all selected templates restored

#### 4.4 Permanent Delete (if available)
1. Open archived drawer
2. Select archived template
3. Click red "Delete" button (permanent delete)
4. Verify scary confirmation modal appears
5. Confirm deletion
6. Verify template completely removed (not in main list or archived)

**Edge Cases**:
- Restore template with same name as existing template
- Archive then immediately restore (race condition)
- Search in archived drawer for non-existent template

---

### 5. CSV Import

**Objective**: Test CSV file import functionality

> Note: CSV Import Modal may be accessed via the Bulk Create Modal's "Import CSV" button

**Steps**:

#### 5.1 Download Sample CSV
1. Click "New Template" or access bulk create modal
2. Look for "Import CSV" option
3. Click "Download Sample" button
4. Verify CSV file downloads with correct format

#### 5.2 Valid CSV Import
1. Create a test CSV file with valid data:
```csv
name,activity_type,abbreviation,max_residents,supervision_required
Test Template 1,clinic,TT1,5,false
Test Template 2,inpatient,TT2,3,true
```
2. Drag and drop file onto upload area (or browse)
3. Verify column mapping screen appears
4. Verify auto-detection maps columns correctly
5. Click "Preview Import"
6. Verify preview table shows valid templates with green checkmarks
7. Click "Import X Templates"
8. Verify success message
9. Verify templates appear in main list

#### 5.3 Invalid CSV Import
1. Create CSV with invalid data:
```csv
name,activity_type,max_residents
,invalid_type,-5
Valid Name,clinic,abc
```
2. Import file
3. Verify errors shown:
   - Missing name error
   - Invalid activity_type error
   - Invalid max_residents errors
4. Verify only valid rows can be imported (or none if all invalid)

#### 5.4 Edge Cases
- Empty CSV file
- CSV with only headers, no data rows
- CSV with 1000+ rows (performance)
- CSV with special characters in names: `Template <script>`, quotes, newlines
- CSV with UTF-8 characters (Japanese, emojis, etc.)
- Non-CSV file (.xlsx, .txt, .pdf)
- Corrupt/malformed CSV

---

### 6. Bulk Create Templates (Form)

**Objective**: Test multi-template creation form

**Steps**:

#### 6.1 Modal Access
1. Click "New Template" button
2. If modal has options, select "Create Multiple" or similar
3. Verify bulk create form appears

#### 6.2 Add Templates
1. First template row should already exist (expanded)
2. Enter name: "Bulk Test 1"
3. Select Activity Type: "Clinic"
4. Enter abbreviation: "BT1"
5. Click "Add Template" button at bottom
6. Verify second row appears
7. Enter different data for second template

#### 6.3 Template Row Operations
1. Click collapse chevron on a row - verify fields hide
2. Click duplicate button (copy icon) - verify duplicate row created with "(Copy)" suffix
3. Click delete button (trash) on duplicate - verify row removed
4. Try to delete last remaining row - verify button disabled or prevented

#### 6.4 Submit Multiple Templates
1. Add 5 valid templates with unique names
2. Click "Create X Templates" button
3. Verify loading state on button
4. Verify success message
5. Verify all templates appear in main list

#### 6.5 Validation
1. Leave a name field empty - verify error shown
2. Enter duplicate names - verify error shown
3. Try to submit with errors - verify blocked

**Edge Cases**:
- Create 50 templates at once
- Very long template name (255+ characters)
- Special characters in names
- Color picker edge cases (invalid hex, browser compatibility)

---

### 7. Pattern Management

**Objective**: Test weekly pattern editor for templates

**Steps**:

#### 7.1 Access Pattern Editor
1. Find a template in the table
2. Click the Calendar icon in Actions column
3. Verify pattern editor modal opens
4. Verify template name shown in header

#### 7.2 Pattern Editor Functionality
1. Observe the weekly grid (7 days x time slots)
2. Click on an empty slot - verify it becomes selected/filled
3. Click on a filled slot - verify it toggles off
4. Make several changes
5. Verify "Saving..." indicator appears
6. Close modal
7. Re-open - verify changes persisted

#### 7.3 Pattern Types (if available)
1. Look for pattern type selector (Regular, Split, Mirrored, Alternating)
2. Select each pattern type
3. Verify grid updates accordingly
4. Test day of week selectors

**Edge Cases**:
- Select all days then unselect all
- Rapid clicking on grid cells
- Close modal during save operation
- Network disconnect during pattern save

---

### 8. Preference Management

**Objective**: Test scheduling preferences for templates

**Steps**:

#### 8.1 Access Preference Editor
1. Find a template in the table
2. Click the Settings (gear) icon in Actions column
3. Verify preferences editor modal opens

#### 8.2 Preference Operations
1. If preferences exist, view them
2. Click "Add Preference" button
3. Select preference type from dropdown
4. Select weight (Low, Medium, High, Required)
5. Click Save
6. Verify preference appears in list
7. Close and re-open - verify persisted

#### 8.3 Edit/Delete Preferences
1. Click edit on existing preference
2. Change weight
3. Save changes
4. Click delete on a preference
5. Confirm deletion

**Edge Cases**:
- Add all available preference types (max out the list)
- Delete all preferences
- Duplicate preference types
- Required vs optional weights

---

### 9. Inline Editing (if enabled)

**Objective**: Test click-to-edit table cells

> Note: Check if `enableInlineEdit` is enabled on the TemplateTable

**Steps**:

#### 9.1 Text Field Inline Edit
1. Click on a template name in the table
2. Verify input field appears inline
3. Type new name
4. Press Enter to save
5. Verify name updated

#### 9.2 Number Field Inline Edit
1. Click on Max Residents cell
2. Change value
3. Press Enter
4. Verify value updated

#### 9.3 Select Field Inline Edit
1. Click on Activity Type cell
2. Verify dropdown appears
3. Select new type
4. Verify updates immediately

#### 9.4 Keyboard Navigation
1. Tab through editable cells
2. Enter to start editing
3. Escape to cancel
4. Arrow keys in number fields

**Edge Cases**:
- Press Escape during edit - verify original value restored
- Click outside during edit - verify behavior
- Edit then lose focus (blur) - verify saves or cancels
- Rapid double-click

---

### 10. Error Handling and Network Resilience

**Objective**: Test application behavior under failure conditions

**Steps**:

#### 10.1 Network Disconnection
1. Open DevTools > Network tab
2. Set to "Offline" mode
3. Try to delete a template - verify error toast appears
4. Try to save changes - verify graceful error
5. Re-enable network - verify operations resume

#### 10.2 Backend Down
1. Stop the backend server
2. Refresh the page - verify error state shown (not blank screen)
3. Try operations - verify meaningful error messages
4. Start backend - verify recovery

#### 10.3 Slow Network
1. DevTools > Network > Slow 3G
2. Perform bulk update - verify loading states show
3. Verify no duplicate submissions
4. Verify timeout handling

#### 10.4 Error Toasts
1. Trigger various errors
2. Verify toast notifications appear
3. Verify toasts are dismissible
4. Verify toasts auto-hide after timeout

---

### 11. Accessibility Testing

**Objective**: Ensure WCAG 2.1 AA compliance

**Steps**:

#### 11.1 Keyboard-Only Navigation
1. Disable mouse (or don't use it)
2. Navigate entire page using only keyboard
3. Verify all interactive elements reachable via Tab
4. Verify focus indicators visible
5. Verify modals trap focus
6. Verify Escape closes modals

#### 11.2 Screen Reader Compatibility
1. Enable VoiceOver (Mac) or NVDA (Windows)
2. Navigate the template table
3. Verify table headers announced
4. Verify buttons have accessible names
5. Verify form fields labeled

#### 11.3 Contrast and Visibility
1. Check all text has sufficient contrast
2. Verify focus indicators visible on dark background
3. Check error states are distinguishable (not just color)

#### 11.4 ARIA Attributes
1. Inspect modals for `role="dialog"` and `aria-modal="true"`
2. Check buttons have `aria-label` where text unclear
3. Verify form inputs have labels or `aria-label`

---

### 12. Data Persistence Verification

**Objective**: Ensure all changes persist correctly to database

**Steps**:

1. Create a new template via bulk create
2. Note all field values
3. Refresh the page
4. Verify template exists with correct values

5. Update template via inline edit
6. Refresh page
7. Verify changes persisted

8. Delete a template
9. Refresh page
10. Verify template gone

11. Archive a template
12. Refresh page
13. Verify template in archived drawer

14. Restore template
15. Refresh page
16. Verify template back in main list

---

## Edge Cases Checklist

### Input Validation
- [ ] Empty names
- [ ] Names with only whitespace
- [ ] Names with 255+ characters
- [ ] Names with SQL injection attempts: `'; DROP TABLE--`
- [ ] Names with XSS attempts: `<script>alert('xss')</script>`
- [ ] Names with path traversal: `../../../etc/passwd`
- [ ] Unicode/emoji names
- [ ] Control characters in names

### Number Fields
- [ ] Negative numbers where positive expected
- [ ] Zero where minimum is 1
- [ ] Decimal numbers where integer expected
- [ ] NaN / Infinity
- [ ] Very large numbers (overflow)
- [ ] Empty strings submitted as numbers

### Selection States
- [ ] Select 0 items (toolbar hidden)
- [ ] Select 1 item
- [ ] Select all items
- [ ] Select then filter (selection preserved?)
- [ ] Select across pages (if pagination)

### Concurrent Operations
- [ ] Double-click submit buttons
- [ ] Multiple tabs editing same template
- [ ] Delete while editing same template in another tab
- [ ] Rapid bulk operations

### Browser Compatibility (if time permits)
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

---

## Issue Reporting Format

For each issue found, document:

```markdown
### [SEVERITY] Issue Title

**Location**: Page/Component/Element
**Steps to Reproduce**:
1. Step one
2. Step two
3. ...

**Expected Behavior**: What should happen

**Actual Behavior**: What actually happens

**Screenshot/Recording**: (if applicable)

**Console Errors**: (if any)

**Browser/OS**: Chrome 120 / macOS Sonoma
```

### Severity Levels

- **CRITICAL**: Security vulnerability, data loss, complete feature failure
- **HIGH**: Feature broken for most users, significant UX degradation
- **MEDIUM**: Feature partially broken, workaround exists
- **LOW**: Minor UX issue, cosmetic with functional impact
- **COSMETIC**: Visual-only issue, no functional impact

---

## Test Completion Checklist

- [ ] All 12 scenario sections tested
- [ ] Edge cases from checklist attempted
- [ ] Issues documented with reproduction steps
- [ ] Accessibility spot-check completed
- [ ] Network resilience tested
- [ ] Data persistence verified
- [ ] Summary of findings prepared

---

## Deliverables

At test completion, provide:

1. **Executive Summary**: Overall assessment (Pass/Fail/Conditional)
2. **Issue List**: All issues found, sorted by severity
3. **Feature Coverage**: Which features were tested successfully
4. **Recommendations**: Priority fixes and improvements
5. **Test Evidence**: Any screenshots, console logs, or recordings

---

*Generated by SYNTHESIZER for Antigravity GUI Pentest Session*
*Target: Admin Templates Panel v1.0*
*Date: 2026-01-04*
