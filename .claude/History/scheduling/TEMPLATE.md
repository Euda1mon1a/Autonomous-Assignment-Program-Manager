# Schedule Generation - [Block/Period Name]

**Date:** YYYY-MM-DD
**Generation ID:** [Unique identifier, e.g., gen001, block10_gen002]
**Generated By:** [Agent name, e.g., SCHEDULER]
**Status:** [SUCCESS | PARTIAL | FAILED]

---

## Summary

[One-sentence summary of what was generated and outcome]

**Example:** "Generated complete Block 10 schedule (July-August 2025) for 12 residents with 3 approved leave requests and 1 TDY absence."

---

## Context

**Why was this schedule generated?**
- [ ] New academic year (routine)
- [ ] Regeneration due to conflicts
- [ ] Emergency coverage adjustment
- [ ] Optimization request
- [ ] Other: ___________

**Date Range:**
- Start Date: YYYY-MM-DD
- End Date: YYYY-MM-DD
- Total Blocks: [Number, e.g., 122 blocks for 2 months]

**Affected Personnel:**
- Residents: [Count] (PGY-1: X, PGY-2: Y, PGY-3: Z)
- Faculty: [Count]
- Total Assignments: [Number]

**Special Circumstances:**
- [ ] New resident cohort (PGY-1 onboarding)
- [ ] Scheduled absences (leave, conferences, board exams)
- [ ] Deployment/TDY (operational tempo changes)
- [ ] Moonlighting adjustments
- [ ] Credential expirations
- [ ] Other: ___________

---

## Parameters

### Algorithm Configuration

**Solver:**
- Primary: [e.g., OR-Tools CP-SAT v9.7]
- Secondary: [e.g., Pareto optimization, if applicable]
- Timeout: [e.g., 30 minutes]
- Threads: [e.g., 8 CPU cores]

**Optimization Objectives (in priority order):**
1. [e.g., ACGME compliance (hard constraint)]
2. [e.g., Minimum staffing coverage (hard constraint)]
3. [e.g., Fair call distribution (soft constraint, weight: 10)]
4. [e.g., Preference satisfaction (soft constraint, weight: 5)]
5. [e.g., Continuity of care (soft constraint, weight: 3)]

**Configuration Flags:**
- N-1 Contingency: [ENABLED | DISABLED]
- Resilience Threshold: [e.g., 0.7]
- Max Utilization: [e.g., 80%]
- Solver Kill-Switch: [ENABLED | DISABLED]

---

## Constraints

### Tier 1: Regulatory (Hard Constraints - MUST Satisfy)

**ACGME Compliance:**
- [ ] 80-hour weekly limit (4-week rolling average)
- [ ] 1-in-7 day off (24-hour period free of clinical duties)
- [ ] Supervision ratios (PGY-1: 1:2, PGY-2/3: 1:4)

**Credential Requirements:**
- [ ] Slot-type invariants enforced (e.g., N95 fit for inpatient, BLS current)
- [ ] Expiring credentials flagged (within 30 days)
- [ ] Hard failures prevented (no assignments to ineligible personnel)

**Coverage Minimums:**
- Inpatient: [e.g., 2 residents minimum per AM/PM block]
- Clinic: [e.g., 3 residents minimum per half-day]
- Call: [e.g., 1 senior (PGY-2/3) + 1 junior (PGY-1)]
- Procedures: [e.g., 1 credentialed resident per session]

**Pre-Assigned Blocks:**
- Leave requests: [Count, e.g., 15 blocks]
- Conferences: [Count, e.g., 8 blocks]
- TDY/Deployment: [Count, e.g., 40 blocks]
- Board exams: [Count, e.g., 6 blocks]

### Tier 2: Institutional (Hard Constraints Unless Waived)

**Local Policies:**
- [ ] Maximum consecutive days: [e.g., 6 days]
- [ ] Night Float rotation limits: [e.g., 2 weeks per block]
- [ ] Specialty coverage (e.g., pediatrics continuity)
- [ ] Call frequency: [e.g., max 1 in 4 nights]

**Rotation Structure:**
- Required rotations per PGY level: [List]
- Blocked rotations (must complete sequentially): [List]
- Rotation duration constraints: [e.g., minimum 2 weeks]

### Tier 3: Optimization (Soft Constraints - Optimize)

**Fairness:**
- Call distribution variance target: [e.g., < 1σ]
- Weekend distribution variance target: [e.g., < 1σ]
- Undesirable shift balance: [e.g., Night Float, holiday call]

**Preferences:**
- Preferred clinic days: [e.g., honor 60%+ of requests]
- Rotation preferences: [e.g., honor 40%+ of requests]
- Avoid back-to-back call: [e.g., penalty weight: 5]

**Educational Goals:**
- Procedure exposure targets: [e.g., min 20 sessions/year]
- Specialty diversity: [e.g., no more than 3 consecutive blocks same rotation]
- Continuity clinic assignments: [e.g., same day of week]

### Tier 4: Nice-to-Have (Lowest Priority)

- Preferred off days for social events
- Commute optimization
- Buddy system (paired schedules)

---

## Constraint Evaluation

### Relaxation Log

**Were any constraints relaxed? If yes, document:**

| Constraint | Tier | Reason for Relaxation | Impact | Approved By |
|------------|------|----------------------|--------|-------------|
| [e.g., Preferred clinic day for PGY1-03] | Soft-3 | Conflict with mandatory orientation | 1 resident affected, preference deferred to Block 11 | SCHEDULER (automated) |
| [e.g., Continuity of care for PGY2-05] | Soft-2 | N-1 contingency (FAC-PD TDY) | 1 resident, 3 extra handoffs | SCHEDULER + Faculty approval |

**If no constraints relaxed:**
- [X] All constraints satisfied without relaxation

### Conflicts Detected

**Pre-Generation Conflicts:**
- [List any conflicts identified during preparation phase]
- [e.g., "PGY2-01 leave request overlaps with required conference (Aug 15-17). Resolution: Moved leave to Aug 18-20."]

**Post-Generation Conflicts:**
- [List any conflicts detected after generation]
- [e.g., "Supervision ratio violation detected for Aug 22 AM (3 PGY-1s, 0 faculty). Resolution: Reassigned FAC-APD from admin block."]

**Resolved Conflicts:** [Count]
**Unresolved Conflicts:** [Count - must be 0 for SUCCESS status]

---

## Solver Statistics

**Execution Metrics:**
- **Solve Time:** [e.g., 4m 32s] (Target: < 5m for Block 10, < 30m for full year)
- **Iterations:** [e.g., 127,543 iterations]
- **Solver Status:** [e.g., OPTIMAL | FEASIBLE | INFEASIBLE | TIMEOUT]
- **Objective Value:** [e.g., 8,542.3] (lower is better for penalty-based objectives)

**Search Statistics:**
- Branches explored: [e.g., 12,847]
- Backtracks: [e.g., 2,103]
- Conflicts detected: [e.g., 87]
- Propagations: [e.g., 1,245,678]

**Resource Usage:**
- Peak memory: [e.g., 2.3 GB]
- CPU utilization: [e.g., 87% average across 8 cores]
- Timeout triggered: [YES | NO]
- Kill-switch activated: [YES | NO]

**Performance Notes:**
- [Any observations about solver performance]
- [e.g., "Solve time 20% slower than Block 9 due to 3 additional leave requests increasing constraint complexity."]

---

## Coverage Analysis

**Staffing Levels:**

| Service/Rotation | Blocks | Min Required | Avg Assigned | Max Assigned | Variance |
|------------------|--------|--------------|--------------|--------------|----------|
| Inpatient AM | 61 | 2 | 2.8 | 4 | 0.6σ |
| Inpatient PM | 61 | 2 | 2.7 | 4 | 0.7σ |
| Clinic | 40 | 3 | 3.5 | 5 | 0.4σ |
| Procedures | 24 | 1 | 1.8 | 3 | 0.5σ |
| Call | 61 | 2 | 2.1 | 3 | 0.3σ |
| Conference | 12 | 12 | 12 | 12 | 0 |

**Coverage Completeness:**
- Total Blocks in Period: [e.g., 122]
- Blocks Assigned: [e.g., 122]
- Coverage: [e.g., 100%]

**Gaps Identified:**
- [List any coverage gaps]
- [If none: "No coverage gaps identified"]

---

## Resilience Score

**Health Assessment:**

| Metric | Value | Threshold | Status |
|--------|-------|-----------|--------|
| Overall Health Score | [e.g., 0.83] | ≥ 0.7 | ✅ PASS |
| Avg Utilization | [e.g., 72%] | ≤ 80% | ✅ PASS |
| N-1 Resilience | [e.g., 0.91] | ≥ 0.8 | ✅ PASS |
| N-2 Resilience | [e.g., 0.68] | ≥ 0.6 | ✅ PASS |
| Burnout Risk (Rt) | [e.g., 0.4] | < 1.0 | ✅ PASS |

**Defense-in-Depth Level:**
- Current Level: [GREEN | YELLOW | ORANGE | RED | BLACK]
- Utilization: [e.g., 72%] (GREEN: ≤80%, YELLOW: 80-85%, ORANGE: 85-90%, RED: 90-95%, BLACK: >95%)

**Contingency Status:**
- N-1 Scenarios Tested: [e.g., 15 scenarios (all key personnel)]
- N-1 Failures: [e.g., 0] (Target: 0)
- N-2 Scenarios Tested: [e.g., 10 critical pairs]
- N-2 Degraded Service: [e.g., 2 scenarios require load shedding]

**Bottleneck Analysis:**
- Key Personnel: [List residents/faculty approaching 80% utilization]
  - [e.g., "PGY3-02: 78% utilization (approaching threshold)"]
  - [e.g., "FAC-PD: 82% utilization (YELLOW alert - schedule coverage mitigation)"]

---

## ACGME Compliance

**Validation Results:**

| Rule | Residents Evaluated | Violations | Status |
|------|---------------------|------------|--------|
| 80-hour weekly limit | [e.g., 12] | [e.g., 0] | ✅ PASS |
| 1-in-7 day off | [e.g., 12] | [e.g., 0] | ✅ PASS |
| Supervision ratios | [e.g., 12] | [e.g., 0] | ✅ PASS |

**Detailed Compliance Checks:**
- Max weekly hours (any resident): [e.g., 76.5 hours by PGY3-01]
- Min days off per week (any resident): [e.g., 1 day (compliant)]
- Worst supervision ratio: [e.g., 1:1.8 PGY-1s per faculty (compliant)]

**Near-Misses (within 10% of threshold):**
- [List any residents close to ACGME limits]
- [e.g., "PGY3-01: 76.5 hours (4.4% buffer from 80-hour limit). Monitor in Block 11."]

**Violations (if any):**
- [If violations exist, MUST document and remediate before schedule commit]
- [If none: "Zero ACGME violations detected."]

---

## Trade-offs and Rationale

**Key Decisions Made:**

1. **[Decision 1]**
   - **What:** [e.g., "Assigned PGY1-03 to Tuesday clinic instead of preferred Wednesday"]
   - **Why:** [e.g., "Wednesday clinic full due to 2 residents on leave. Tuesday had capacity."]
   - **Alternative Considered:** [e.g., "Swap PGY2-04 to Tuesday, but would create cascade conflict with call schedule."]
   - **Trade-off:** [e.g., "Preference satisfaction -1, coverage optimization +2"]

2. **[Decision 2]**
   - **What:** [e.g., "Activated N-1 contingency for FAC-PD TDY (Aug 10-20)"]
   - **Why:** [e.g., "Program Director scheduled for mandatory training. Pre-assign backup supervisor (FAC-APD)."]
   - **Alternative Considered:** [e.g., "Reschedule training, but training is non-negotiable."]
   - **Trade-off:** [e.g., "FAC-APD utilization increases from 65% to 82% (YELLOW alert)"]

3. **[Decision 3]**
   - **What:** [Description]
   - **Why:** [Rationale]
   - **Alternative Considered:** [Options evaluated]
   - **Trade-off:** [What was sacrificed vs. gained]

**Optimization Strategy:**
- Primary Goal: [e.g., "Maximize ACGME compliance and coverage completeness"]
- Secondary Goal: [e.g., "Minimize call distribution variance"]
- Accepted Trade-off: [e.g., "Preference satisfaction at 58% (target 60%) to achieve fairness goal"]

---

## Outcome

**Final Status:** [SUCCESS | PARTIAL | FAILED]

**Success Criteria:**
- [X] ACGME compliance: 100% (0 violations)
- [X] Coverage completeness: 100% (all blocks assigned)
- [X] Resilience health: ≥ 0.7
- [X] Fairness: Call variance < 1σ
- [ ] Preference satisfaction: ≥ 60% (Actual: 58% - acceptable variance)

**Metrics Summary:**

| Metric | Target | Actual | Status |
|--------|--------|--------|--------|
| ACGME Compliance | 100% | 100% | ✅ |
| Coverage Completeness | 100% | 100% | ✅ |
| Resilience Health Score | ≥ 0.7 | 0.83 | ✅ |
| Call Distribution Variance | < 1σ | 0.8σ | ✅ |
| Preference Satisfaction | ≥ 60% | 58% | ⚠️ |
| Solve Time | < 5m | 4m 32s | ✅ |

**Quality Score:** [e.g., 95/100]
- ACGME: 25/25 (perfect compliance)
- Coverage: 25/25 (complete)
- Fairness: 20/20 (excellent call balance)
- Efficiency: 15/15 (fast solve time)
- Preferences: 10/15 (slightly below target)

---

## Impact

**Affected Personnel:**
- Residents notified: [e.g., 12 residents via email + dashboard]
- Faculty notified: [e.g., 5 faculty via email]
- Services updated: [e.g., Clinic coordinator, ER scheduler, ICU charge nurse]

**System Updates:**
- Dashboard: [UPDATED | PENDING]
- Calendar integrations: [SYNCED | PENDING]
- Compliance monitor: [ACTIVE | PENDING]
- Backup created: [YES | NO] - Backup ID: [e.g., backup_block10_20250715]

**Downstream Effects:**
- [Any cascading changes needed]
- [e.g., "Block 11 preference data updated based on Block 10 deferred requests."]

---

## Validation & Review

**Automated Validation:**
- [ ] ACGME validator: PASS
- [ ] Coverage validator: PASS
- [ ] Credential validator: PASS
- [ ] Resilience health check: PASS
- [ ] Database integrity check: PASS

**Human Review Checklist:**
- [ ] FMIT ratios within target (use schedule-verification skill)
- [ ] Call distribution balanced (≤ 1σ variance)
- [ ] Night Float assignments fair
- [ ] Clinic days evenly distributed
- [ ] Absences properly handled (leave, TDY, conferences)
- [ ] No obvious conflicts or anomalies

**Reviewed By:** [e.g., SCHEDULER (automated) + Faculty approval pending]

**Approval Status:**
- [ ] Approved - commit to production
- [ ] Conditionally Approved - minor adjustments needed
- [ ] Rejected - regeneration required

**Approval Timestamp:** [YYYY-MM-DD HH:MM:SS or PENDING]

---

## Follow-Up Actions

**Immediate (within 24 hours):**
- [ ] Notify all affected residents
- [ ] Update calendar integrations
- [ ] Activate compliance monitoring
- [ ] Document backup restoration procedure

**Short-Term (within 1 week):**
- [ ] Monitor for conflicts or complaints
- [ ] Address any resident concerns
- [ ] Track preference deferral for Block 11 consideration
- [ ] Review FAC-APD utilization (YELLOW alert)

**Long-Term (before next generation):**
- [ ] Analyze solver performance trends
- [ ] Update constraint weights based on outcomes
- [ ] Incorporate learnings into MetaUpdater
- [ ] Review and update credential expiration tracking

**MetaUpdater Notes:**
- [Any patterns or learnings for future schedule generations]
- [e.g., "Consider adding hard constraint for min 3-day gap between call shifts to improve resident satisfaction."]

---

## Related Records

**References:**
- Backup: [e.g., `.claude/Backups/backup_block10_20250715.dump`]
- Previous Schedule: [e.g., `.claude/History/scheduling/2025-05-15_block09_gen001.md`]
- Compliance Audit: [e.g., `.claude/History/compliance/2025-07-31_monthly_audit.md`]
- Resilience Assessment: [e.g., `.claude/History/resilience/2025-07-01_health_check.md`]

**Linked Issues:**
- [Any related incidents, bugs, or improvement proposals]
- [e.g., "See incident: `.claude/History/incidents/2025-07-10_solver_timeout.md` for context on solver timeout mitigation."]

---

## Attachments

**Exported Files:**
- [ ] Schedule CSV: [Path if exported]
- [ ] PDF Report: [Path if generated]
- [ ] Excel Workbook: [Path if generated]
- [ ] Compliance Report: [Path if generated]

**Code References:**
- Solver version: [e.g., `backend/app/scheduling/engine.py` @ commit abc1234]
- Constraint catalog: [e.g., `backend/app/scheduling/constraints/` @ commit abc1234]
- Validation logic: [e.g., `backend/app/scheduling/acgme_validator.py` @ commit abc1234]

---

**Entry Created:** YYYY-MM-DD HH:MM:SS
**Created By:** [Agent name]
**Committed To Git:** [YES | NO]
**Commit Hash:** [Git commit hash, if applicable]

---

## Notes

[Any additional context, observations, or lessons learned]

**Example:**
- "First schedule generation with new N-1 contingency logic. System correctly identified FAC-PD TDY and pre-assigned backup. No manual intervention required."
- "Solver performance degraded 20% due to increased constraint complexity (3 additional leave requests). Consider constraint simplification for future blocks."
