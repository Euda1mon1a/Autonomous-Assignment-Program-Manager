# Call Assignments API Reference

> **Base URL:** `/api/v1/call-assignments`
> **Authentication:** Required (Bearer token)
> **Last Updated:** 2025-12-26

---

## Overview

The Call Assignments API provides endpoints for managing overnight faculty call assignments. While most assignments are generated by the scheduling solver, this API allows manual management for adjunct faculty and provides reporting capabilities.

## Endpoints

### List Call Assignments

Retrieve call assignments with optional filters.

```http
GET /api/v1/call-assignments
```

#### Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `start_date` | date | No | Filter by start date (inclusive) |
| `end_date` | date | No | Filter by end date (inclusive) |
| `person_id` | UUID | No | Filter by specific person |
| `call_type` | string | No | Filter by call type (`overnight`, `weekend`, `backup`) |

#### Response

```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "date": "2025-01-15",
    "person_id": "123e4567-e89b-12d3-a456-426614174000",
    "call_type": "overnight",
    "is_weekend": false,
    "is_holiday": false,
    "created_at": "2025-01-01T12:00:00Z",
    "person_name": "Dr. Smith",
    "day_of_week": "Wednesday"
  }
]
```

---

### Get Single Call Assignment

Retrieve a specific call assignment by ID.

```http
GET /api/v1/call-assignments/{assignment_id}
```

#### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `assignment_id` | UUID | The call assignment ID |

#### Response

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "date": "2025-01-15",
  "person_id": "123e4567-e89b-12d3-a456-426614174000",
  "call_type": "overnight",
  "is_weekend": false,
  "is_holiday": false,
  "created_at": "2025-01-01T12:00:00Z",
  "person_name": "Dr. Smith",
  "day_of_week": "Wednesday"
}
```

#### Errors

| Status | Description |
|--------|-------------|
| 404 | Call assignment not found |

---

### Create Call Assignment

Manually create a call assignment (typically for adjunct faculty).

```http
POST /api/v1/call-assignments
```

#### Request Body

```json
{
  "date": "2025-01-15",
  "person_id": "123e4567-e89b-12d3-a456-426614174000",
  "call_type": "overnight",
  "is_weekend": false,
  "is_holiday": false
}
```

#### Fields

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `date` | date | Yes | - | Date of the call assignment |
| `person_id` | UUID | Yes | - | Faculty member ID |
| `call_type` | string | No | `"overnight"` | Type: `overnight`, `weekend`, or `backup` |
| `is_weekend` | boolean | No | `false` | True if weekend call |
| `is_holiday` | boolean | No | `false` | True if holiday call |

#### Response

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "date": "2025-01-15",
  "person_id": "123e4567-e89b-12d3-a456-426614174000",
  "call_type": "overnight",
  "is_weekend": false,
  "is_holiday": false,
  "created_at": "2025-01-15T10:30:00Z",
  "person_name": "Dr. Smith",
  "day_of_week": "Wednesday"
}
```

#### Errors

| Status | Description |
|--------|-------------|
| 400 | Invalid data or duplicate assignment |

---

### Bulk Create Call Assignments

Create multiple call assignments at once (typically from solver output).

```http
POST /api/v1/call-assignments/bulk
```

#### Request Body

```json
{
  "assignments": [
    {
      "date": "2025-01-13",
      "person_id": "123e4567-e89b-12d3-a456-426614174000",
      "call_type": "overnight"
    },
    {
      "date": "2025-01-14",
      "person_id": "456e7890-e89b-12d3-a456-426614174000",
      "call_type": "overnight"
    }
  ],
  "replace_existing": true,
  "schedule_run_id": "789e0123-e89b-12d3-a456-426614174000"
}
```

#### Fields

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `assignments` | array | Yes | - | List of assignments to create |
| `replace_existing` | boolean | No | `true` | Delete existing in date range first |
| `schedule_run_id` | UUID | No | - | Associated schedule run ID |

#### Response

```json
{
  "created": 5,
  "schedule_run_id": "789e0123-e89b-12d3-a456-426614174000"
}
```

---

### Delete Call Assignment

Remove a call assignment.

```http
DELETE /api/v1/call-assignments/{assignment_id}
```

#### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `assignment_id` | UUID | The call assignment ID |

#### Response

```
204 No Content
```

#### Errors

| Status | Description |
|--------|-------------|
| 404 | Call assignment not found |

---

### Coverage Report

Get a coverage analysis for a date range.

```http
GET /api/v1/call-assignments/reports/coverage
```

#### Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `start_date` | date | Yes | Report start date |
| `end_date` | date | Yes | Report end date |

#### Response

```json
{
  "start_date": "2025-01-01",
  "end_date": "2025-01-31",
  "total_nights": 22,
  "covered_nights": 20,
  "gaps": [
    {
      "date": "2025-01-15",
      "day_of_week": "Wednesday"
    },
    {
      "date": "2025-01-22",
      "day_of_week": "Wednesday"
    }
  ],
  "coverage_percentage": 90.9
}
```

**Note:** Only Sun-Thurs nights are counted. Fri-Sat are handled by FMIT.

---

### Equity Report

Get call distribution equity analysis for a year.

```http
GET /api/v1/call-assignments/reports/equity
```

#### Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `year` | integer | Yes | Year for the report |

#### Response

```json
{
  "year": 2025,
  "faculty_counts": [
    {
      "person_id": "123e4567-e89b-12d3-a456-426614174000",
      "person_name": "Dr. Smith",
      "total_calls": 24,
      "sunday_calls": 8,
      "weekday_calls": 16
    },
    {
      "person_id": "456e7890-e89b-12d3-a456-426614174000",
      "person_name": "Dr. Jones",
      "total_calls": 22,
      "sunday_calls": 7,
      "weekday_calls": 15
    }
  ],
  "sunday_stats": {
    "min": 7,
    "max": 9,
    "mean": 7.8,
    "stddev": 0.6
  },
  "weekday_stats": {
    "min": 14,
    "max": 17,
    "mean": 15.5,
    "stddev": 1.1
  },
  "equity_score": 0.92
}
```

The `equity_score` ranges from 0 to 1, where higher values indicate more equitable distribution (lower coefficient of variation).

---

## Schema Reference

### CallAssignmentCreate

```json
{
  "date": "2025-01-15",
  "person_id": "uuid",
  "call_type": "overnight",
  "is_weekend": false,
  "is_holiday": false
}
```

### CallAssignmentResponse

```json
{
  "id": "uuid",
  "date": "2025-01-15",
  "person_id": "uuid",
  "call_type": "overnight",
  "is_weekend": false,
  "is_holiday": false,
  "created_at": "2025-01-15T10:30:00Z",
  "person_name": "Dr. Smith",
  "day_of_week": "Wednesday"
}
```

### CallCoverageReport

```json
{
  "start_date": "2025-01-01",
  "end_date": "2025-01-31",
  "total_nights": 22,
  "covered_nights": 20,
  "gaps": [{"date": "...", "day_of_week": "..."}],
  "coverage_percentage": 90.9
}
```

### CallEquityReport

```json
{
  "year": 2025,
  "faculty_counts": [...],
  "sunday_stats": {"min": 0, "max": 0, "mean": 0.0, "stddev": 0.0},
  "weekday_stats": {"min": 0, "max": 0, "mean": 0.0, "stddev": 0.0},
  "equity_score": 0.0
}
```

---

## Error Responses

All error responses follow this format:

```json
{
  "detail": "Error message describing the issue"
}
```

Common HTTP status codes:

| Status | Description |
|--------|-------------|
| 400 | Bad Request - Invalid input data |
| 401 | Unauthorized - Authentication required |
| 403 | Forbidden - Insufficient permissions |
| 404 | Not Found - Resource doesn't exist |
| 422 | Unprocessable Entity - Validation error |
| 500 | Internal Server Error |
